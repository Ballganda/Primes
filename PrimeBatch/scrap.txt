REM ********* function *****************************
:strlen <resultVar> <stringVar>
(   
    setlocal EnableDelayedExpansion
    (set^ tmp=!%~2!)
    if defined tmp (
        set "len=1"
        for %%P in (4096 2048 1024 512 256 128 64 32 16 8 4 2 1) do (
            if "!tmp:~%%P,1!" NEQ "" ( 
                set /a "len+=%%P"
                set "tmp=!tmp:~%%P!"
            )
        )
    ) ELSE (
        set len=0
    )
)
( 
    endlocal
    set "%~1=%len%"
    exit /b
)

:strlen0  StrVar  [RtnVar]
  setlocal EnableDelayedExpansion
  set "s=#!%~1!"
  set "len=0"
  for %%N in (4096 2048 1024 512 256 128 64 32 16 8 4 2 1) do (
    if "!s:~%%N,1!" neq "" (
      set /a "len+=%%N"
      set "s=!s:~%%N!"
    )
  )
  endlocal&if "%~2" neq "" (set %~2=%len%) else echo %len%
  GOTO :EOF


for /L %%A in (2, 2, 8000) do (
  if "!p[1]:~%%A,1!"=="1" (
    set p[1]=!p[1]:~0,%%A! 0 !p[1]:~%%A+1,8000-(%%A+1)!
  )
)
goto :eof

@echo off & title NoFocusEngineer

::internate tel me i ned dis
setlocal EnableDelayedExpansion 

set i[0]=
set i[0]=1111111121


set p[1]=%i[0]%

CALL :SIEVE
ECHO p[1]= %p[1]%
pause
GOTO :END

:SIEVE
for /L %%A in (2, 2, 10) do (
  if "!p[1]:~,1!"=="1" (
   set left=!p[1]:~0,%%A!
   echo left =!left!
   SET right=!p[1]:~%%A!
   for /L %%B in (1,1,8000) do ( if "!right:~%%B!"=="" set len=%%B & set right=!p[1]:~%%B! & exit /B)
   :: set right=!p[1]:~^^!r^^!!
   echo right =!right!
   set p[1]=!left!0!right!
   echo p[1]=!p[1]!
  )
)
goto :eof

:FLOORINTSQRT
 REM ECHO %0
 SET "arg1=, init=, iter=" 
 SET /A arg1=%1
 IF %arg1% GTR 0 (
   SET /A "init=%arg1%/(11*1024)+40"
   SET /A "iter=!init!"
   FOR /L %%I in (1,1,5) DO (
     set /A "iter=(%arg1%/!iter!+!iter!)/2"
     IF %%I EQU 5 (
       SET /A isqrt=!iter!
       SET /A sqr=!isqrt!*!isqrt!
       IF !sqr! GTR %arg1% (
         SET /A isqrt-=1
         SET /A sqr=!isqrt!*!isqrt!
       )
       ECHO ISQRT(%arg1%^)=!isqrt! check SQR(!isqrt!^) = !sqr! Variable name is isqrt
     )
   )
 )
 IF %arg1% EQU 0 (ECHO Input zero no ISQRT)
 IF %arg1% LSS 0 (ECHO Input negative ISQRT irrational)
GOTO :EOF

pause
goto :eof

@ECHO off & TITLE NoFocusEngineer
::internate tel me i ned dis
SETLOCAL EnableDelayedExpansion
:: Record time started
SET TIMESTART=%TIME% 
:: empty the initialization matrix
SET i[0]=
:: fill i[0] arraywith 8000 1s
SET i[0]=1112111111
rem 11111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111
:: set the p arrays up
SET p[1]=
SET p[1]=%i[0]%

SET pmax=%1


CALL :FLOORINTSQRT %pmax%
CALL :SIEVE
CALL :CONVERTTIMESECONDS TIMESTART TIMESTARTSEC
CALL :CONVERTTIMESECONDS TIMEFINISH TIMEFINISHSEC
CALL :GETELAPSED
ECHO p[1]=%p[1]%
GOTO :END

:SIEVE
   ECHO %0
   FOR /L %%A in (2, 2, !isqrt!) DO (
      rem SET /P _PRINT=%%A <NUL
	  SET /A offset=%%A-1
	  FOR %%B in (!offset!) DO (set test=!p[1]:~%%B,1!)
	  echo test = !test!
      IF "!test!"=="1" (
         SET /A START=%%A
         SET /A STEP=%%A
		 FOR /L %%V IN (!START!,!STEP!,!pmax!) DO (
		     SET left=!p[1]:~0,%%V!
			 echo left =!left!
			 SET right=!p[1]:~%%V!D
			 SET right=!p[1]:~1,-1!
			 echo right=!right!
			 pause
             SET p[1]=!left!0!right!
		    )
        )
    )
   SET TIMEFINISH=%TIME%
GOTO :EOF

:other2
   ECHO %0
   FOR /L %%L IN (3,2,!isqrt!) DO (
      SET /P _PRINT=%%L <NUL
      IF NOT DEFINED %%L (
         SET /A START=%%L * %%L
         SET /A STEP=%%L * 2
         FOR /L %%V IN (!START!,!STEP!,!NMAX!) DO (
		    SET "%%V=~")
         )
      )
   ECHO.
   CALL :GETELAPSED
   GOTO :EOF

:FLOORINTSQRT
 ECHO %0
 SET "arg1=, init=, iter=" 
 SET /A arg1=%1
 IF %arg1% GTR 0 (
   SET /A "init=%arg1%/(11*1024)+40"
   SET /A "iter=!init!"
   FOR /L %%I in (1,1,5) DO (
     set /A "iter=(%arg1%/!iter!+!iter!)/2"
     IF %%I EQU 5 (
       SET /A isqrt=!iter!
       SET /A sqr=!isqrt!*!isqrt!
       IF !sqr! GTR %arg1% (
         SET /A isqrt-=1
         SET /A sqr=!isqrt!*!isqrt!
       )
       REM ECHO FLOORISQRT(%arg1%^)=!isqrt!
     )
   )
 )
 IF %arg1% EQU 0 (ECHO Input zero no ISQRT)
 IF %arg1% LSS 0 (ECHO Input negative ISQRT irrational)
GOTO :EOF

:CONVERTTIMESECONDS
 ECHO %0
 SET T=!%1!
 SET T=!T::0=:!
 SET T=!T:.0=.!
   FOR /F "TOKENS=1-4 DELIMS=:." %%W IN ("!T!") DO (
     SET /A %2=%%W * 360000 + %%X * 6000 + %%Y * 100 + %%Z
   )
 REM Output var is = %2 input argument 2 passed to function
GOTO :EOF

:GETELAPSED
 ECHO %0
   SET /A ELAPSED=TIMEFINISHSEC - TIMESTARTSEC
   SET /A WHOLES=ELAPSED / 100
   SET MILLIS=!ELAPSED:~-2!0
   IF "!ELAPSED!" LSS "0" (
      SET /A ELAPSED=ELAPSED + (24 * 360000)
      )
   ECHO TimeElapsed=!WHOLES!.!MILLIS! Seconds
GOTO :EOF

:END

@echo off & title Primer GOTO & set "start=%time%"

setlocal enabledelayedexpansion
set /a "test=3, nthprime=3, limit=10000"
set "bitmap="
set "n=Y"

:nextprime
if %test% gtr %limit% (goto gameover)
set /a "test+=2, index=0, div=3"
if %test% lss 1000 (set bitmap=%bitmap%%n%)

:nexttest
if "!bitmap:~%index%,1!"=="N" goto nextdiv
set /a "resi=!test!%%!div!"
if %resi% equ 0 (set "n=N"& goto nextprime)

:nextdiv
set /a index+=1,div+=2,div2=div*div
if %div2% gtr %test% (
 echo %test% is Prime
 set "n=Y"
 set /a "total=%nthprime%,nthprime+=1"
 goto nextprime
)

goto nexttest

:gameover
echo %total% primes up to %limit%
echo/ start: %start%
echo finish: %time%
pause
exit /b
